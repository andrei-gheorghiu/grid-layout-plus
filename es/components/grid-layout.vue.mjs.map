{"version":3,"file":"grid-layout.vue.mjs","sources":["../../src/components/grid-layout.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport {\r\n  nextTick,\r\n  onBeforeMount,\r\n  onBeforeUnmount,\r\n  onMounted,\r\n  provide,\r\n  reactive,\r\n  ref,\r\n  toRefs,\r\n  watch\r\n} from 'vue'\r\n\r\nimport GridItem from './grid-item.vue'\r\nimport { useResize } from '@vexip-ui/hooks'\r\nimport { createEventEmitter, debounce, isNull } from '@vexip-ui/utils'\r\nimport {\r\n  EMITTER_KEY,\r\n  LAYOUT_KEY,\r\n  bottom,\r\n  cloneLayout,\r\n  compact,\r\n  getAllCollisions,\r\n  getLayoutItem,\r\n  moveElement,\r\n  validateLayout\r\n} from '../helpers/common'\r\nimport {\r\n  findOrGenerateResponsiveLayout,\r\n  getBreakpointFromWidth,\r\n  getColsFromBreakpoint\r\n} from '../helpers/responsive'\r\n\r\nimport type { PropType } from 'vue'\r\nimport type {\r\n  Breakpoint,\r\n  Breakpoints,\r\n  Layout,\r\n  LayoutInstance,\r\n  ResponsiveLayout\r\n} from '../helpers/types'\r\n\r\nconst props = defineProps({\r\n  autoSize: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  colNum: {\r\n    type: Number,\r\n    default: 12\r\n  },\r\n  rowHeight: {\r\n    type: Number,\r\n    default: 150\r\n  },\r\n  maxRows: {\r\n    type: Number,\r\n    default: Infinity\r\n  },\r\n  margin: {\r\n    type: Array as PropType<number[]>,\r\n    default: () => [10, 10]\r\n  },\r\n  isDraggable: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  isResizable: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  isMirrored: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  isBounded: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  useCssTransforms: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  verticalCompact: {\r\n    type: Boolean,\r\n    default: true\r\n  },\r\n  restoreOnDrag: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  layout: {\r\n    type: Array as PropType<Layout>,\r\n    required: true\r\n  },\r\n  responsive: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  responsiveLayouts: {\r\n    type: Object as PropType<Partial<ResponsiveLayout>>,\r\n    default: () => ({})\r\n  },\r\n  transformScale: {\r\n    type: Number,\r\n    default: 1\r\n  },\r\n  breakpoints: {\r\n    type: Object as PropType<Breakpoints>,\r\n    default: () => ({ xxl: 1400, xl: 1200, lg: 992, md: 768, sm: 576, xs: 0 })\r\n  },\r\n  cols: {\r\n    type: Object as PropType<Breakpoints>,\r\n    default: () => ({ xxl: 12, xl: 12, lg: 8, md: 6, sm: 4, xs: 2 })\r\n  },\r\n  preventCollision: {\r\n    type: Boolean,\r\n    default: false\r\n  },\r\n  useStyleCursor: {\r\n    type: Boolean,\r\n    default: true\r\n  }\r\n})\r\n\r\nconst emit = defineEmits([\r\n  'layout-before-mount',\r\n  'layout-mounted',\r\n  'layout-updated',\r\n  'breakpoint-changed',\r\n  'update:layout',\r\n  'layout-ready'\r\n])\r\n\r\nconst state = reactive({\r\n  width: -1,\r\n  mergedStyle: {},\r\n  lastLayoutLength: 0,\r\n  isDragging: false,\r\n  placeholder: {\r\n    x: 0,\r\n    y: 0,\r\n    w: 0,\r\n    h: 0,\r\n    i: '' as number | string\r\n  },\r\n  layouts: {} as Record<Breakpoint, Layout>, // array to store all layouts from different breakpoints\r\n  lastBreakpoint: null as Breakpoint | null, // store last active breakpoint\r\n  originalLayout: null! as Layout // store original Layout\r\n})\r\n\r\nconst itemInstances = new Map<number | string, any>()\r\n\r\nconst currentLayout = ref(props.layout)\r\nconst wrapper = ref<HTMLElement>()\r\n\r\nconst { observeResize, unobserveResize } = useResize()\r\nconst emitter = createEventEmitter()\r\n\r\nemitter.on('resizeEvent', resizeEventHandler)\r\nemitter.on('dragEvent', dragEventHandler)\r\n\r\nonBeforeMount(() => {\r\n  emit('layout-before-mount', currentLayout.value)\r\n})\r\n\r\nonMounted(() => {\r\n  emit('layout-mounted', currentLayout.value)\r\n\r\n  nextTick(() => {\r\n    validateLayout(currentLayout.value)\r\n\r\n    state.originalLayout = currentLayout.value\r\n\r\n    nextTick(() => {\r\n      initResponsiveFeatures()\r\n      wrapper.value && observeResize(wrapper.value, debounce(onWindowResize, 16))\r\n      compact(currentLayout.value, props.verticalCompact)\r\n      emit('layout-updated', currentLayout.value)\r\n      updateHeight()\r\n      onWindowResize()\r\n    })\r\n  })\r\n})\r\n\r\nonBeforeUnmount(() => {\r\n  emitter.clearAll()\r\n  wrapper.value && unobserveResize(wrapper.value)\r\n})\r\n\r\nfunction resizeEventHandler(\r\n  eventType: string,\r\n  i: number | string,\r\n  x: number,\r\n  y: number,\r\n  h: number,\r\n  w: number\r\n) {\r\n  resizeEvent(eventType, i, x, y, h, w)\r\n}\r\n\r\nfunction dragEventHandler(\r\n  eventType: string,\r\n  i: number | string,\r\n  x: number,\r\n  y: number,\r\n  h: number,\r\n  w: number\r\n) {\r\n  dragEvent(eventType, i, x, y, h, w)\r\n}\r\n\r\nwatch(\r\n  () => state.width,\r\n  (newVal, oldVal) => {\r\n    nextTick(() => {\r\n      emitter.emit('updateWidth', newVal)\r\n      if (oldVal === -1) {\r\n        /*\r\n        If oldVal === -1 is when the width has never been\r\n        set before. That only occurs when mounting is\r\n        finished, and onWindowResize has been called and\r\n        this.width has been changed the first time after it\r\n        got set to null in the constructor. It is now time\r\n        to issue layout-ready events as the GridItems have\r\n        their sizes configured properly.\r\n\r\n        The reason for emitting the layout-ready events on\r\n        the next tick is to allow for the newly-emitted\r\n        updateWidth event (above) to have reached the\r\n        children GridItem-s and had their effect, so we're\r\n        sure that they have the final size before we emit\r\n        layout-ready (for this GridLayout) and\r\n        item-layout-ready (for the GridItem-s).\r\n\r\n        This way any client event handlers can reliably\r\n        investigate stable sizes of GridItem-s.\r\n      */\r\n        nextTick(() => {\r\n          emit('layout-ready', currentLayout.value)\r\n        })\r\n      }\r\n      updateHeight()\r\n    })\r\n  }\r\n)\r\nwatch(\r\n  () => [props.layout, props.layout.length],\r\n  () => {\r\n    currentLayout.value = props.layout\r\n    layoutUpdate()\r\n  }\r\n)\r\nwatch(\r\n  () => props.colNum,\r\n  val => {\r\n    emitter.emit('setColNum', val)\r\n  }\r\n)\r\nwatch(\r\n  () => props.rowHeight,\r\n  value => {\r\n    emitter.emit('setRowHeight', value)\r\n  }\r\n)\r\nwatch(\r\n  () => props.isDraggable,\r\n  value => {\r\n    emitter.emit('setDraggable', value)\r\n  }\r\n)\r\nwatch(\r\n  () => props.isResizable,\r\n  value => {\r\n    emitter.emit('setResizable', value)\r\n  }\r\n)\r\nwatch(\r\n  () => props.isBounded,\r\n  value => {\r\n    emitter.emit('setBounded', value)\r\n  }\r\n)\r\nwatch(\r\n  () => props.transformScale,\r\n  value => {\r\n    emitter.emit('setTransformScale', value)\r\n  }\r\n)\r\nwatch(\r\n  () => props.responsive,\r\n  value => {\r\n    if (!value) {\r\n      emit('update:layout', state.originalLayout)\r\n      emitter.emit('setColNum', props.colNum)\r\n    }\r\n    onWindowResize()\r\n  }\r\n)\r\nwatch(\r\n  () => props.maxRows,\r\n  value => {\r\n    emitter.emit('setMaxRows', value)\r\n  }\r\n)\r\nwatch([() => props.margin, () => props.margin[1]], updateHeight)\r\n\r\nprovide(\r\n  LAYOUT_KEY,\r\n  reactive({\r\n    ...toRefs(props),\r\n    ...toRefs(state),\r\n    increaseItem,\r\n    decreaseItem\r\n  }) as LayoutInstance\r\n)\r\nprovide(EMITTER_KEY, emitter)\r\n\r\ndefineExpose({ state, getItem, resizeEvent, dragEvent })\r\n\r\nfunction increaseItem(item: any) {\r\n  itemInstances.set(item.i, item)\r\n}\r\n\r\nfunction decreaseItem(item: any) {\r\n  itemInstances.delete(item.i)\r\n}\r\n\r\nfunction getItem(id: number | string) {\r\n  return itemInstances.get(id)\r\n}\r\n\r\nfunction layoutUpdate() {\r\n  if (!isNull(currentLayout.value) && !isNull(state.originalLayout)) {\r\n    if (currentLayout.value.length !== state.originalLayout.length) {\r\n      const diff = findDifference(currentLayout.value, state.originalLayout)\r\n\r\n      if (diff.length > 0) {\r\n        if (currentLayout.value.length > state.originalLayout.length) {\r\n          state.originalLayout = state.originalLayout.concat(diff)\r\n        } else {\r\n          const ids = new Set(diff.map(item => item.i))\r\n          state.originalLayout = state.originalLayout.filter(item => !ids.has(item.i))\r\n        }\r\n      }\r\n\r\n      state.lastLayoutLength = currentLayout.value.length\r\n      initResponsiveFeatures()\r\n    }\r\n\r\n    compact(currentLayout.value, props.verticalCompact)\r\n    emitter.emit('updateWidth', state.width)\r\n    updateHeight()\r\n\r\n    emit('layout-updated', currentLayout.value)\r\n  }\r\n}\r\n\r\nfunction updateHeight() {\r\n  state.mergedStyle = {\r\n    height: containerHeight()\r\n  }\r\n}\r\n\r\nfunction onWindowResize() {\r\n  if (wrapper.value) {\r\n    state.width = wrapper.value.offsetWidth\r\n  }\r\n\r\n  emitter.emit('resizeEvent')\r\n}\r\n\r\nfunction containerHeight() {\r\n  if (!props.autoSize) return\r\n\r\n  const marginY = parseFloat(props.margin[1] as any)\r\n  const containerHeight = bottom(currentLayout.value) * (props.rowHeight + marginY) + marginY + 'px'\r\n  return containerHeight\r\n}\r\n\r\nlet positionsBeforeDrag: Record<string, { x: number, y: number }> | undefined\r\n\r\nfunction dragEvent(\r\n  eventName: string,\r\n  id: number | string,\r\n  x: number,\r\n  y: number,\r\n  h: number,\r\n  w: number\r\n) {\r\n  let l = getLayoutItem(currentLayout.value, id)!\r\n\r\n  // GetLayoutItem sometimes returns null object\r\n  if (isNull(l)) {\r\n    l = { h: 0, w: 0, x: 0, y: 0, i: '' }\r\n  }\r\n\r\n  if (eventName === 'dragstart' && !props.verticalCompact) {\r\n    positionsBeforeDrag = currentLayout.value.reduce(\r\n      (result, { i, x, y }) => ({\r\n        ...result,\r\n        [i]: { x, y }\r\n      }),\r\n      {}\r\n    )\r\n  }\r\n\r\n  if (eventName === 'dragmove' || eventName === 'dragstart') {\r\n    state.placeholder.i = id\r\n    state.placeholder.x = l.x\r\n    state.placeholder.y = l.y\r\n    state.placeholder.w = w\r\n    state.placeholder.h = h\r\n\r\n    nextTick(() => {\r\n      state.isDragging = true\r\n    })\r\n\r\n    emitter.emit('updateWidth', state.width)\r\n  } else {\r\n    nextTick(() => {\r\n      state.isDragging = false\r\n    })\r\n  }\r\n\r\n  // Move the element to the dragged location.\r\n  currentLayout.value = moveElement(currentLayout.value, l, x, y, true, props.preventCollision)\r\n\r\n  if (props.restoreOnDrag) {\r\n    // Do not compact items more than in layout before drag\r\n    // Set moved item as static to avoid to compact it\r\n    l.static = true\r\n    compact(currentLayout.value, props.verticalCompact, positionsBeforeDrag)\r\n    l.static = false\r\n  } else {\r\n    compact(currentLayout.value, props.verticalCompact)\r\n  }\r\n\r\n  // needed because vue can't detect changes on array element properties\r\n  emitter.emit('compact')\r\n  updateHeight()\r\n  if (eventName === 'dragend') {\r\n    positionsBeforeDrag = undefined\r\n    emit('layout-updated', currentLayout.value)\r\n  }\r\n}\r\n\r\nfunction resizeEvent(\r\n  eventName: string,\r\n  id: number | string,\r\n  x: number,\r\n  y: number,\r\n  h: number,\r\n  w: number\r\n) {\r\n  let l = getLayoutItem(currentLayout.value, id)!\r\n  // GetLayoutItem sometimes return null object\r\n  if (isNull(l)) {\r\n    l = { h: 0, w: 0, x: 0, y: 0, i: '' }\r\n  }\r\n\r\n  let hasCollisions\r\n  if (props.preventCollision) {\r\n    const collisions = getAllCollisions(currentLayout.value, { ...l, w, h }).filter(\r\n      layoutItem => layoutItem.i !== l.i\r\n    )\r\n    hasCollisions = collisions.length > 0\r\n\r\n    // If we're colliding, we need adjust the placeholder.\r\n    if (hasCollisions) {\r\n      // adjust w && h to maximum allowed space\r\n      let leastX = Infinity\r\n      let leastY = Infinity\r\n      collisions.forEach(layoutItem => {\r\n        if (layoutItem.x > l.x) leastX = Math.min(leastX, layoutItem.x)\r\n        if (layoutItem.y > l.y) leastY = Math.min(leastY, layoutItem.y)\r\n      })\r\n\r\n      if (Number.isFinite(leastX)) l.w = leastX - l.x\r\n      if (Number.isFinite(leastY)) l.h = leastY - l.y\r\n    }\r\n  }\r\n\r\n  if (!hasCollisions) {\r\n    // Set new width and height.\r\n    l.w = w\r\n    l.h = h\r\n  }\r\n\r\n  if (eventName === 'resizestart' || eventName === 'resizemove') {\r\n    state.placeholder.i = id\r\n    state.placeholder.x = x\r\n    state.placeholder.y = y\r\n    state.placeholder.w = l.w\r\n    state.placeholder.h = l.h\r\n    nextTick(() => {\r\n      state.isDragging = true\r\n    })\r\n    // this.$broadcast(\"updateWidth\", this.width);\r\n    emitter.emit('updateWidth', state.width)\r\n  } else {\r\n    nextTick(() => {\r\n      state.isDragging = false\r\n    })\r\n  }\r\n\r\n  if (props.responsive) responsiveGridLayout()\r\n\r\n  compact(currentLayout.value, props.verticalCompact)\r\n  emitter.emit('compact')\r\n  updateHeight()\r\n\r\n  if (eventName === 'resizeend') emit('layout-updated', currentLayout.value)\r\n}\r\n\r\nfunction responsiveGridLayout() {\r\n  const newBreakpoint = getBreakpointFromWidth(props.breakpoints, state.width)\r\n  const newCols = getColsFromBreakpoint(newBreakpoint, props.cols)\r\n\r\n  // save actual layout in layouts\r\n  if (!isNull(state.lastBreakpoint) && !state.layouts[state.lastBreakpoint]) {\r\n    state.layouts[state.lastBreakpoint] = cloneLayout(currentLayout.value)\r\n  }\r\n\r\n  // Find or generate a new layout.\r\n  const layout = findOrGenerateResponsiveLayout(\r\n    state.originalLayout,\r\n    state.layouts,\r\n    props.breakpoints,\r\n    newBreakpoint,\r\n    state.lastBreakpoint!,\r\n    newCols,\r\n    props.verticalCompact\r\n  )\r\n\r\n  // Store the new layout.\r\n  state.layouts[newBreakpoint] = layout\r\n\r\n  if (state.lastBreakpoint !== newBreakpoint) {\r\n    emit('breakpoint-changed', newBreakpoint, layout)\r\n  }\r\n\r\n  // new prop sync\r\n  emit('update:layout', layout)\r\n\r\n  state.lastBreakpoint = newBreakpoint\r\n  emitter.emit('setColNum', getColsFromBreakpoint(newBreakpoint, props.cols))\r\n}\r\n\r\nfunction initResponsiveFeatures() {\r\n  // clear layouts\r\n  state.layouts = Object.assign({} as Record<Breakpoint, Layout>, props.responsiveLayouts)\r\n}\r\n\r\nfunction findDifference(layout: Layout, originalLayout: Layout) {\r\n  const originalIds = new Set(originalLayout.map(item => item.i))\r\n  const ids = new Set(layout.map(item => item.i))\r\n\r\n  // Find values that are in result1 but not in result2\r\n  const uniqueResultOne = layout.filter(item => !originalIds.has(item.i))\r\n\r\n  // Find values that are in result2 but not in result1\r\n  const uniqueResultTwo = originalLayout.filter(item => !ids.has(item.i))\r\n\r\n  // Combine the two arrays of unique entries#\r\n  return uniqueResultOne.concat(uniqueResultTwo)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div ref=\"wrapper\" class=\"vgl-layout\" :style=\"state.mergedStyle\">\r\n    <slot v-if=\"$slots.default\"></slot>\r\n    <template v-else>\r\n      <GridItem v-for=\"item in currentLayout\" :key=\"item.i\" v-bind=\"item\">\r\n        <slot name=\"item\" :item=\"item\"></slot>\r\n      </GridItem>\r\n    </template>\r\n    <GridItem\r\n      v-show=\"state.isDragging\"\r\n      class=\"vgl-item--placeholder\"\r\n      :x=\"state.placeholder.x\"\r\n      :y=\"state.placeholder.y\"\r\n      :w=\"state.placeholder.w\"\r\n      :h=\"state.placeholder.h\"\r\n      :i=\"state.placeholder.i\"\r\n    ></GridItem>\r\n  </div>\r\n</template>\r\n"],"names":["props","__props","emit","__emit","state","reactive","itemInstances","currentLayout","ref","wrapper","observeResize","unobserveResize","useResize","emitter","createEventEmitter","resizeEventHandler","dragEventHandler","onBeforeMount","onMounted","nextTick","validateLayout","initResponsiveFeatures","debounce","onWindowResize","compact","updateHeight","onBeforeUnmount","eventType","i","x","y","h","w","resizeEvent","dragEvent","watch","newVal","oldVal","layoutUpdate","val","value","provide","LAYOUT_KEY","toRefs","increaseItem","decreaseItem","EMITTER_KEY","__expose","getItem","item","id","isNull","diff","findDifference","ids","containerHeight","marginY","bottom","positionsBeforeDrag","eventName","l","getLayoutItem","result","moveElement","hasCollisions","collisions","getAllCollisions","layoutItem","leastX","leastY","responsiveGridLayout","newBreakpoint","getBreakpointFromWidth","newCols","getColsFromBreakpoint","cloneLayout","layout","findOrGenerateResponsiveLayout","originalLayout","originalIds","uniqueResultOne","uniqueResultTwo"],"mappings":"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"}